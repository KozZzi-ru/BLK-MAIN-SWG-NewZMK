# КОНФИГУРАЦИЯ ZMK ДЛЯ CHARYBDIS 4X6 WIRELESS MK2 (BLK)

Прошивка ZMK для беспроводной сплит-клавиатуры **Charybdis 4x6 MK2 (черная)** с трекболом PMW3610.

## Особенности

✅ **Исправлен тамб кластер МК2**: Все клавиши работают корректно
✅ **8-колоночная матрица**: Универсальный keymap для МК1 и МК2
✅ **Два независимых режима скролла**: Быстрый и медленный
✅ **PMW3610 трекбол**: Драйвер badjeff zmk-0.4

## Аппаратная конфигурация

- **Контроллер**: nice_nano (ProMicro nRF52840)
- **Клавиатура**: Charybdis 4x6 MK2 (черная)
- **Трекбол**: PMW3610 (CPI 1000)
- **ZMK**: main branch (rolling release)
- **Zephyr**: 4.1

## Решение проблемы тамб кластера МК2

### Проблема

У МК2 **разная распайка** для основной матрицы и тамб кластера:

**Основная матрица (Row 0-3)**:
- Использует новые пины МК2: P0.10, P1.13 (вместо P1.0, P0.11 у МК1)

**Тамб кластер (Row 4)**:
- Использует смешанные пины:
  - Col 0, 1, 2: общие пины (P0.2, P0.29, P0.9)
  - Col 5, 6: новые пины МК2 (P0.10, P1.13)

### Решение

Используем **8-колоночную матрицу** с универсальным matrix transform:

**Col-gpios (8 колонок на каждую половину)**:
- Col 0: P0.2 (общая)
- Col 1: P0.29 (общая)
- Col 2: P0.9 (общая)
- Col 3: P1.0 (старая МК1 - не используется)
- Col 4: P0.11 (старая МК1 - не используется)
- Col 5: P0.10 (новая МК2) ✅
- Col 6: P1.13 (новая МК2) ✅
- Col 7: P1.4 (общая)

**Matrix Transform для Row 4 (тамб кластер)**:
```
Левая: RC(4,5) RC(4,0) RC(4,1) RC(4,6) RC(4,2)
Правая: RC(4,8) RC(4,13) RC(4,9)
```

Маппинг:
- Левая: Col 5, 0, 1, 6, 2 → пины P0.10, P0.2, P0.29, P1.13, P0.9
- Правая: Col 0, 5, 1 (offset +8) → пины P0.2, P0.10, P0.29

**Результат**: Все 8 клавиш тамб кластера (5 слева + 3 справа) работают! ✅

## Режимы трекбола

### 1. Снайперский режим (layer 3)
- Масштаб: 1:3 (замедление в 3 раза)
- Назначение: Точные операции

### 2. Режим мыши (layer 2)
- Масштаб: 1:1 (нативная скорость)
- Назначение: Стандартное управление

### 3. Медленный скролл (layer 1)
- Масштаб: 1:16
- Раздельные оси: вертикаль 1:8, горизонталь 1:16

### 4. Быстрый скролл (layer 0)
- Масштаб: 1:10
- Раздельные оси: вертикаль 1:4, горизонталь 1:8

## Сборка и прошивка

### GitHub Actions

1. Автоматическая сборка при каждом push
2. Скачай артефакт `firmware_BLK_SVG`
3. В артефакте: `.uf2` файлы + SVG визуализация

### Прошивка устройства

1. Дважды нажми reset на плате
2. Плата появится как `NICENANO`
3. Скопируй `.uf2` файл на накопитель
4. Плата автоматически перезагрузится

## История изменений

### 08.02.2026 - Исправлен тамб кластер МК2 с правильным matrix transform
- Проведена диагностика реальной распайки
- Выявлено: тамб кластер использует Col 0,1,2,5,6
- Левая тамб: RC(4,5) RC(4,0) RC(4,1) RC(4,6) RC(4,2)
- Правая тамб: RC(4,8) RC(4,13) RC(4,9)
- Все 8 клавиш тамб кластера теперь работают корректно

### 05.02.2026 - Экстремальные делители скролла
- Медленный скролл: xy=16, wheel=8, hwheel=16
- Быстрый скролл: xy=10, wheel=4, hwheel=8

## Полезные ссылки

- [ZMK Firmware](https://github.com/zmkfirmware/zmk)
- [PMW3610 Driver by badjeff](https://github.com/badjeff/zmk-pmw3610-driver)
- [ZMK Input Processors](https://zmk.dev/docs/keymaps/input-processors/scaler)
